(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2566],{10055:(e,t,r)=>{"use strict";r.d(t,{l:()=>n});var a=r(34477);let n=(0,a.createServerReference)("7fef4df98f8100d06e751157b15c80f945dc54bf85",a.callServer,void 0,a.findSourceMapURL,"destroySession")},12388:(e,t,r)=>{"use strict";r.d(t,{N_:()=>o,a8:()=>l,rd:()=>c});var a=r(47830),n=r(43089);let s=(0,a.o)({locales:["en","nep"],defaultLocale:"en"}),{Link:o,redirect:i,usePathname:l,useRouter:c,getPathname:u}=(0,n.xp)(s)},19373:(e,t,r)=>{"use strict";r.d(t,{g:()=>n});var a=r(34477);let n=(0,a.createServerReference)("7f7177a3269b8d8c2c9a6ecaeea5051add2a3581c1",a.callServer,void 0,a.findSourceMapURL,"getSessionClient")},26108:(e,t,r)=>{"use strict";r.d(t,{default:()=>T});var a=r(95155),n=r(64778),s=r(93758),o=r(86491),i=r(12388),l=r(86769),c=r(26715),u=r(41754),d=r(5041),p=r(17238),h=r(36768),f=r(94326),y=r(20534),v=r(46002),m=r(89584),g=r(94600),j=r(72070),A=r(77325),w=r(95891),S=r(12160),x=r(12115),_=r(70445),k=r(6124),P=r(97226),b=r(12515);let C=function(e){let{data:t}=e,{token:{colorPrimary:r}}=_.A.useToken();return(0,a.jsx)(k.A,{hoverable:!0,size:"small",type:"inner",children:(0,a.jsxs)(p.A,{wrap:"wrap",gap:20,children:[(0,a.jsx)(b.ljw,{size:35,color:r}),(0,a.jsxs)(P.A,{size:"small",direction:"vertical",wrap:!0,children:[(0,a.jsx)(w.A,{children:t.sms}),(0,a.jsx)(w.A,{type:"secondary",children:(e=>{let t=new Date(e),r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][t.getUTCDay()],a=t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",timeZone:"UTC"}),n=t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1,timeZone:"UTC"});return"".concat(r,", ").concat(a,": ").concat(n)})(t.created_at)})]})]})})};function E(e){let{isModalOpen:t,handleCancel:r,handleOk:n}=e,l=(0,i.rd)(),h=(0,c.jE)(),[w,x]=f.Ay.useMessage(),{data:_,isLoading:k}=(0,u.I)({queryKey:["groups"],queryFn:s.Wx}),P=(0,d.n)({mutationFn:o.K3,onError:e=>w.error(e.message)}),b=(0,d.n)({mutationFn:o.W8,onError:e=>w.error(e.message),onSuccess:()=>{h.invalidateQueries({queryKey:["userData"]}),l.refresh(),w.success("Bulk SMS sent successfully!"),n()}}),[C]=y.A.useForm(),E=async(e,t)=>{var r,a;let n=C.getFieldsValue();return(null===(r=n.group_ids)||void 0===r?void 0:r.length)>>0||(null===(a=n.csv)||void 0===a?void 0:a.length)>>0?Promise.resolve():Promise.reject("Please select at least one group or upload a CSV file.")};return(0,a.jsxs)(v.A,{title:"Basic Modal",open:t,onOk:n,onCancel:r,footer:null,children:[x,(0,a.jsxs)(y.A,{form:C,onFinish:e=>{var t;let r={type:"sms",sms:e.sms,group_ids:e.group_ids};if((null===(t=e.csv)||void 0===t?void 0:t.length)>>0){let t=new FormData;t.append("csv_file",e.csv[0].originFileObj,"csv.csv"),P.mutate(t,{onSuccess:e=>{b.mutate({...r,csv_url:e.csv_path})}})}else b.mutate({...r})},layout:"vertical",children:[(0,a.jsx)(y.A.Item,{rules:[{validator:E}],name:"group_ids",label:"Select your groups",children:(0,a.jsx)(m.A,{loading:k,mode:"multiple",maxTagCount:"responsive",options:null==_?void 0:_.map(e=>({value:e.id,label:e.name}))})}),(0,a.jsx)(g.A,{children:"Or"}),(0,a.jsx)(y.A.Item,{name:"csv",valuePropName:"fileList",getValueFromEvent:e=>Array.isArray(e)?e:null==e?void 0:e.fileList,rules:[{validator:E}],children:(0,a.jsx)(S.A,{customRequest:e=>{let{onSuccess:t}=e;return setTimeout(()=>{t("ok",null)},0)},accept:"text/csv",name:"file",maxCount:1,action:void 0,fileList:void 0,children:(0,a.jsx)("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload CSV"})})}),(0,a.jsx)(y.A.Item,{name:"sms",label:"SMS",rules:[{required:!0,message:"Please write a meesage to send!"}],children:(0,a.jsx)(j.A.TextArea,{})}),(0,a.jsxs)(p.A,{justify:"space-between",wrap:"wrap",children:[(0,a.jsx)(A.Ay,{onClick:r,children:"Cancel"}),(0,a.jsx)(A.Ay,{loading:b.isPending||P.isPending,htmlType:"submit",type:"primary",children:"Send"})]})]})]})}let T=function(e){let{smsData:t}=e,[r,s]=(0,x.useState)(!1);return(0,a.jsxs)(p.A,{vertical:!0,gap:20,children:[(0,a.jsx)(w.A,{style:{position:"absolute",fontSize:"1.25rem"},children:"Bulk SMS"}),(0,a.jsx)(n.default,{type:"link",onClick:()=>{s(!0)},icon:(0,a.jsx)(l.A,{}),children:"Send Bulk SMS"}),(0,a.jsx)(E,{isModalOpen:r,handleCancel:()=>{s(!1)},handleOk:()=>{s(!1)}}),0!==t.length?(0,a.jsx)(p.A,{vertical:!0,gap:10,children:t.map(e=>(0,a.jsx)(C,{data:e},e.id))}):(0,a.jsx)(h.A,{description:"You haven't send any bulk SMS yet"})]})}},35133:(e,t,r)=>{"use strict";r.d(t,{Card:()=>a.A});var a=r(6124)},49561:(e,t,r)=>{"use strict";r.d(t,{f6:()=>d,th:()=>h,y1:()=>p});var a=r(23464),n=r(19373),s=r(10055),o=r(74227),i=r(49509);let l=i.env.NEXT_PUBLIC_API_URL,c=l+"/api/v1/",u=l+"/api/v2/",d=a.A.create({baseURL:c,headers:{"Content-Type":"application/json",accept:"application/json"}}),p=a.A.create({baseURL:c,headers:{"Content-Type":"application/json",accept:"application/json"}}),h=a.A.create({baseURL:u,headers:{"Content-Type":"application/json",accept:"application/json"}}),f=[p,a.A.create({baseURL:u,headers:{"Content-Type":"application/json",accept:"application/json"}})];[d,h].forEach(e=>{e.interceptors.response.use(e=>e.data,e=>e.response?Promise.reject(e.response.data.detail):Promise.reject(e.message))}),f.forEach(e=>{e.interceptors.request.use(async e=>{let t=await (0,n.g)();return e.headers.Authorization="Bearer ".concat(t.access_token?t.access_token:"no_token"),e},e=>Promise.reject(e))});let y=!1,v=null,m=[],g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;m.forEach(r=>{let{resolve:a,reject:n,config:s}=r;e?n(e):(t&&(s.headers.Authorization="Bearer ".concat(t)),a(s))}),m=[]};f.forEach(e=>{e.interceptors.response.use(e=>e.data,async t=>{var r,a,o;let i=t.config;if((null===(r=t.response)||void 0===r?void 0:r.status)===401&&!i._retry){if(i._retry=!0,y)return new Promise((e,t)=>{m.push({resolve:e,reject:t,config:i})}).then(t=>e(t));v||(y=!0,v=j());try{if(!await v)return g("Session expired. Please login again."),await (0,s.l)(),Promise.reject("Session expired. Please login again.");{let t=await (0,n.g)();return i.headers.Authorization="Bearer ".concat(t.access_token),g(null,t.access_token),e(i)}}catch(e){return g("Authentication failed. Please login again."),await (0,s.l)(),Promise.reject("Authentication failed. Please login again.")}finally{setTimeout(()=>{v=null,y=!1},100)}}if(!t.response)return Promise.reject(t.message);{let e=t.response.status,r=(null===(a=t.response.data)||void 0===a?void 0:a.detail)||(null===(o=t.response.data)||void 0===o?void 0:o.message)||"An error occurred";return 403===e&&await (0,s.l)(),Promise.reject(r)}})});let j=async()=>{try{let e=await (0,n.g)();if(!(null==e?void 0:e.refresh_token))return await (0,s.l)(),!1;let t=i.env.NEXT_PUBLIC_API_URL;if(!t)throw Error("API URL is not defined");let r=await fetch("".concat(t,"/api/v1/refresh-token"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:e.refresh_token}),cache:"no-store"});if(!r.ok)return await (0,s.l)(),!1;let a=await r.json(),l={...e,access_token:a.access_token,refresh_token:a.refresh_token||e.refresh_token};return await (0,o.N)(l),!0}catch(e){return console.error("Token refresh failed:",e),await (0,s.l)(),!1}}},61860:e=>{e.exports={floatButton:"styles_floatButton__HeivV"}},64778:(e,t,r)=>{"use strict";r.d(t,{default:()=>l});var a=r(95155),n=r(70445),s=r(77325);r(12115);var o=r(61860),i=r.n(o);let l=function(e){let{onClick:t,icon:r,children:o,type:l,style:c}=e,{token:{colorBgBase:u}}=n.A.useToken();return(0,a.jsx)("div",{style:{...c,background:u},className:i().floatButton,onClick:t,children:(0,a.jsx)(s.Ay,{block:!0,size:"large",icon:r,type:l,children:o})})}},68512:(e,t,r)=>{Promise.resolve().then(r.bind(r,35133)),Promise.resolve().then(r.bind(r,45626)),Promise.resolve().then(r.bind(r,48882)),Promise.resolve().then(r.bind(r,26108))},74227:(e,t,r)=>{"use strict";r.d(t,{N:()=>n});var a=r(34477);let n=(0,a.createServerReference)("7fbd64ebe47753c9152c4e6b30624382d1a35ef8f3",a.callServer,void 0,a.findSourceMapURL,"setSession")},86491:(e,t,r)=>{"use strict";r.d(t,{K3:()=>n,W8:()=>o,lh:()=>s});var a=r(49561);async function n(e){let t=new FormData;Array.from(e.entries()).forEach(e=>{let[r,a]=e;"template"===r&&a instanceof File?t.append("file",a):t.append(r,a)}),Array.from(t.entries()).forEach(e=>{let[t,r]=e;console.log("".concat(t,":"),r)});try{return await a.y1.post("files/upload/",t,{headers:{"Content-Type":"multipart/form-data"}})}catch(e){throw Error("API Error: ".concat(e.message))}}async function s(e){try{return await a.y1.post("events/",e)}catch(e){throw Error(e)}}async function o(e){try{return await a.y1.post("events/",e)}catch(e){throw Error(e)}}},93758:(e,t,r)=>{"use strict";r.d(t,{Ni:()=>o,Wx:()=>n,cj:()=>i,wj:()=>s});var a=r(49561);async function n(){try{return await a.y1.get("group/")}catch(e){throw Error(e)}}async function s(e){console.log("Data in createGroup:",e);try{return await a.y1.post("group/",e)}catch(e){throw Error(e)}}async function o(e){try{return await a.y1.delete("group/".concat(e))}catch(e){throw Error(e)}}async function i(e){let{data:t,id:r}=e;try{return await a.y1.put("group/".concat(r),t)}catch(e){throw Error(e)}}}},e=>{var t=t=>e(e.s=t);e.O(0,[2027,5479,4666,6449,6327,3876,3749,8646,8085,7325,6124,6922,6874,9186,7845,5144,2788,3889,9237,534,4714,9584,6002,2070,7110,3741,6738,8441,1684,7358],()=>t(68512)),_N_E=e.O()}]);