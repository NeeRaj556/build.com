(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4728],{4050:(e,t,r)=>{"use strict";r.d(t,{default:()=>m});var a=r(95155);r(12115);var n=r(55028),i=r(88646),o=r(6124),s=r(35695),c=r(19373),l=r(26715),u=r(5041),d=r(24848),h=r(76714),p=r(79312);let f=(0,n.default)(()=>Promise.all([r.e(3743),r.e(8413),r.e(7325),r.e(7845),r.e(2788),r.e(534),r.e(9584),r.e(2070),r.e(7110),r.e(1506),r.e(2660),r.e(9733),r.e(6683),r.e(3175)]).then(r.bind(r,56683)),{loadableGenerated:{webpack:()=>[56683]},ssr:!1,loading:()=>(0,a.jsx)("div",{children:(0,a.jsx)(i.A,{})})}),m=function(e){let{id:t}=e,{data:r,isLoading:n,isSuccess:i}=(0,c.I)({queryKey:["template",t],queryFn:()=>(0,p.dO)(t),staleTime:0,gcTime:0,select:e=>({...e,background_image:e.file_url})}),m=(0,s.useRouter)(),g=(0,l.jE)(),[w,v]=(0,d.A)(),y=(0,u.n)({mutationFn:h.Tj,onError:()=>{w.error("Error while uploading templates/thumbnail!!!")}}),_=(0,u.n)({mutationFn:e=>(0,h.ub)(e,parseInt(t)),onError:()=>{w.error("Error while creating Template!!!")},onSuccess:()=>{w.success("Successfully created Template!!!"),g.invalidateQueries({queryKey:["userTemplates"]}),m.push("/admin/templates")}});return(0,a.jsxs)(a.Fragment,{children:[n&&(0,a.jsx)(o.A,{loading:!0}),v,i&&(0,a.jsx)(f,{loading:y.isPending||_.isPending,onSave:e=>{let t=new FormData;if(!e.title||!e.description){w.error("Please enter title and description correctly");return}if(e.height<=0||e.width<=0){w.error("Please enter height and width correctly");return}if(!e.background_image||!e.thumbnail_url){w.error("Please upload thumbnail and template background image before uploading");return}if(0===e.category_id){w.error("Please select a Template Type");return}e.background_image&&e.thumbnail_url&&(t.append("template",e.background_image),t.append("thumbnail",e.thumbnail_url),e.preview_images&&e.preview_images.length>0&&e.preview_images.forEach((e,r)=>{e.originFileObj&&t.append("preview_images[".concat(r,"]"),e.originFileObj)}),y.mutate(t,{onSuccess:t=>{var r;let a=(null===(r=t.preview_images)||void 0===r?void 0:r.map((t,r)=>{var a;return{filename:(null===(a=e.preview_images[r])||void 0===a?void 0:a.filename)||"image-".concat(r),file_url:t}}))||[],n={...e,refer_id:"".concat(new Date),thumbnail_url:t.thumbnail_url,file_url:t.template_url,preview_images:a};_.mutate(n)}}))},initialTemplate:r})]})}},20149:(e,t,r)=>{Promise.resolve().then(r.bind(r,35133)),Promise.resolve().then(r.bind(r,87626)),Promise.resolve().then(r.bind(r,4050))},35133:(e,t,r)=>{"use strict";r.d(t,{Card:()=>a.A});var a=r(6124)},49561:(e,t,r)=>{"use strict";r.d(t,{f6:()=>d,th:()=>p,y1:()=>h});var a=r(23464),n=r(66608),i=r(51210),o=r(72508),s=r(49509);let c=s.env.NEXT_PUBLIC_API_URL,l=c+"/api/v1/",u=c+"/api/v2/",d=a.A.create({baseURL:l,headers:{"Content-Type":"application/json",accept:"application/json"}}),h=a.A.create({baseURL:l,headers:{"Content-Type":"application/json",accept:"application/json"}}),p=a.A.create({baseURL:u,headers:{"Content-Type":"application/json",accept:"application/json"}}),f=[h,a.A.create({baseURL:u,headers:{"Content-Type":"application/json",accept:"application/json"}})];[d,p].forEach(e=>{e.interceptors.response.use(e=>e.data,e=>e.response?Promise.reject(e.response.data.detail):Promise.reject(e.message))}),f.forEach(e=>{e.interceptors.request.use(async e=>{let t=await (0,n.g)();return e.headers.Authorization="Bearer ".concat(t.access_token?t.access_token:"no_token"),e},e=>Promise.reject(e))});let m=!1,g=null,w=[],v=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;w.forEach(r=>{let{resolve:a,reject:n,config:i}=r;e?n(e):(t&&(i.headers.Authorization="Bearer ".concat(t)),a(i))}),w=[]};f.forEach(e=>{e.interceptors.response.use(e=>e.data,async t=>{var r,a,o;let s=t.config;if((null===(r=t.response)||void 0===r?void 0:r.status)===401&&!s._retry){if(s._retry=!0,m)return new Promise((e,t)=>{w.push({resolve:e,reject:t,config:s})}).then(t=>e(t));g||(m=!0,g=y());try{if(!await g)return v("Session expired. Please login again."),await (0,i.l)(),Promise.reject("Session expired. Please login again.");{let t=await (0,n.g)();return s.headers.Authorization="Bearer ".concat(t.access_token),v(null,t.access_token),e(s)}}catch(e){return v("Authentication failed. Please login again."),await (0,i.l)(),Promise.reject("Authentication failed. Please login again.")}finally{setTimeout(()=>{g=null,m=!1},100)}}if(!t.response)return Promise.reject(t.message);{let e=t.response.status,r=(null===(a=t.response.data)||void 0===a?void 0:a.detail)||(null===(o=t.response.data)||void 0===o?void 0:o.message)||"An error occurred";return 403===e&&await (0,i.l)(),Promise.reject(r)}})});let y=async()=>{try{let e=await (0,n.g)();if(!(null==e?void 0:e.refresh_token))return await (0,i.l)(),!1;let t=s.env.NEXT_PUBLIC_API_URL;if(!t)throw Error("API URL is not defined");let r=await fetch("".concat(t,"/api/v1/refresh-token"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:e.refresh_token}),cache:"no-store"});if(!r.ok)return await (0,i.l)(),!1;let a=await r.json(),c={...e,access_token:a.access_token,refresh_token:a.refresh_token||e.refresh_token};return await (0,o.N)(c),!0}catch(e){return console.error("Token refresh failed:",e),await (0,i.l)(),!1}}},51210:(e,t,r)=>{"use strict";r.d(t,{l:()=>n});var a=r(34477);let n=(0,a.createServerReference)("7f94a4f5be4bbe86ff28602338eb3b1e17757bda33",a.callServer,void 0,a.findSourceMapURL,"destroySession")},66608:(e,t,r)=>{"use strict";r.d(t,{g:()=>n});var a=r(34477);let n=(0,a.createServerReference)("7f6ef96e8b0ebd5011563da96c6f189e5e4212342a",a.callServer,void 0,a.findSourceMapURL,"getSessionClient")},72508:(e,t,r)=>{"use strict";r.d(t,{N:()=>n});var a=r(34477);let n=(0,a.createServerReference)("7f89c1213494ea9ff4952ae407cec9eb241e36637e",a.callServer,void 0,a.findSourceMapURL,"setSession")},76714:(e,t,r)=>{"use strict";r.d(t,{I7:()=>s,JW:()=>h,LZ:()=>l,Tj:()=>o,mn:()=>n,nt:()=>c,tA:()=>p,ub:()=>i,ul:()=>u,yW:()=>d});var a=r(49561);async function n(e){try{return await a.y1.post("templates/",e)}catch(e){throw Error(e)}}async function i(e,t){try{return await a.y1.put("templates/".concat(t),e)}catch(e){throw Error(e)}}async function o(e){try{return await a.y1.post("templates/upload-template-images/",e,{headers:{"Content-Type":"multipart/form-data"}})}catch(e){throw Error(e)}}async function s(e){try{return await a.y1.delete("templates/".concat(e))}catch(e){throw Error(e)}}async function c(){try{return await a.y1.get("templates/?skip=0&limit=100")}catch(e){throw Error(e)}}async function l(){try{return await a.f6.get("categories/?skip=0&limit=100")}catch(e){throw Error(e)}}async function u(e){try{return await a.y1.delete("categories/".concat(e))}catch(e){throw Error(e)}}async function d(e){try{return await a.y1.post("categories/",e)}catch(e){throw Error(e)}}async function h(e){try{return await a.y1.put("categories/".concat(e.id),e)}catch(e){throw Error(e)}}async function p(e){try{return await a.y1.post("categories/upload-image",e,{headers:{"Content-Type":"multipart/form-data"}})}catch(e){throw Error(e)}}},79312:(e,t,r)=>{"use strict";r.d(t,{cp:()=>p,dO:()=>f,jx:()=>h});var a=r(34477);a.callServer,a.findSourceMapURL;var n=r(66608);let i=(0,a.createServerReference)("7fc03f74330daec80a9e1aa0286e4f7e94fb5d90ee",a.callServer,void 0,a.findSourceMapURL,"refreshAccessToken");var o=r(51210);let s=r(49509).env.NEXT_PUBLIC_API_URL,c={"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},l=async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;try{let r=await fetch(e,{...t,cache:t.cache?t.cache:"no-store"});if(!r.ok){let e=await r.text();if(401===r.status)throw Error("Unauthorized access. Please log in again.");throw Error(e||"Unknown error")}return await r.json()}catch(a){if(r>0)return l(e,t,r-1);throw a}},u=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!s)throw Error("API URL is not defined");return l("".concat(s).concat(e),{...t,headers:{...c,...r,...t.headers}})},d=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=await (0,n.g)();if(!s)throw Error("API URL is not defined");let u="".concat(s).concat(e),d={...t,headers:{...c,...r,...t.headers,Authorization:"Bearer ".concat(a.access_token?a.access_token:"no_token")}};try{return await l(u,d)}catch(e){if("Unauthorized access. Please log in again."===e.message&&await i()){a=await (0,n.g)();let e={...d,headers:{...d.headers,Authorization:"Bearer ".concat(a.access_token)}};return await l(u,e)}throw(403===e.status||401===e.status)&&await (0,o.l)(),e}},h=async()=>u("/api/v1/templates/all/",{method:"GET",cache:"no-store"}),p=async()=>u("/api/v1/categories/?skip=0&limit=100",{method:"GET",cache:"no-store"}),f=async e=>d("/api/v1/templates/".concat(e),{method:"GET",cache:"no-store"})}},e=>{var t=t=>e(e.s=t);e.O(0,[4666,6449,6327,3876,3749,8646,8085,6124,6922,9186,5144,3889,9237,4714,7166,8441,1684,7358],()=>t(20149)),_N_E=e.O()}]);