(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4357],{871:(e,t,r)=>{"use strict";r.d(t,{_:()=>s});var a=r(52200),n=r(49509);let o=["places"],s=()=>{let{isLoaded:e,loadError:t}=(0,a.KD)({id:"google-map-script",googleMapsApiKey:n.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY||"AIzaSyAvI6vu7WINuMtM6qBzmHO2m9r3U3jZBCo",libraries:o});return{isLoaded:e,loadError:t}}},1228:(e,t,r)=>{"use strict";r.d(t,{DY:()=>i,Sk:()=>l,_h:()=>s,ec:()=>c,iS:()=>o,p7:()=>n});var a=r(49561);async function n(e){try{return await a.f6.post("login/phone-number",e)}catch(e){throw Error(e)}}async function o(e){try{return await a.f6.post("verify-phone-number",e)}catch(e){throw Error(e)}}async function s(e){try{return await a.th.post("login",e,{headers:{"Content-Type":"application/json"}})}catch(e){throw Error(e)}}async function i(e){try{return await a.f6.post("users/",e)}catch(e){throw Error(e)}}async function l(){try{return await a.y1.get("users/me/")}catch(e){throw Error(e)}}async function c(e){try{return await a.y1.post("change-password",e)}catch(e){throw Error(e)}}},10055:(e,t,r)=>{"use strict";r.d(t,{l:()=>n});var a=r(34477);let n=(0,a.createServerReference)("7fef4df98f8100d06e751157b15c80f945dc54bf85",a.callServer,void 0,a.findSourceMapURL,"destroySession")},12388:(e,t,r)=>{"use strict";r.d(t,{N_:()=>s,a8:()=>l,rd:()=>c});var a=r(47830),n=r(43089);let o=(0,a.o)({locales:["en","nep"],defaultLocale:"en"}),{Link:s,redirect:i,usePathname:l,useRouter:c,getPathname:d}=(0,n.xp)(o)},15543:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var a=r(95155),n=r(12115),o=r(52200),s=r(94326),i=r(77325),l=r(46002),c=r(72070),d=r(92057),u=r(871);let p={width:"100%",height:"500px"};function h(e){let{centerCoords:t,markerState:r,setMarkerState:o,placeName:c,setPlaceName:p}=e,[h,f]=(0,n.useState)(t),[m,y]=(0,n.useState)(!1),[x,v]=(0,n.useState)(!1),j=(0,n.useMemo)(()=>t||{lat:27.63820799904629,lng:85.51344372504178},[t]),[w,A]=(0,n.useState)(j),_=async()=>{v(!0);try{await new Promise((e,t)=>{if(!navigator.geolocation){t(Error("Geolocation not supported"));return}navigator.geolocation.getCurrentPosition(t=>{let a={lat:t.coords.latitude,lng:t.coords.longitude};A(a),f(a),r.lat===j.lat&&r.lng===j.lng&&o(a),s.Ay.success("Location detected successfully"),e(t)},t,{enableHighAccuracy:!1,timeout:1e4,maximumAge:6e5})})}catch(e){try{let e=await fetch("https://ipapi.co/json/"),t=await e.json();if(t.latitude&&t.longitude){let e={lat:t.latitude,lng:t.longitude};A(e),f(e),r.lat===j.lat&&r.lng===j.lng&&o(e)}else throw Error("IP location failed")}catch(e){s.Ay.warning("Could not detect location. Using default location (Kathmandu)."),A(j),f(j),r.lat===j.lat&&(r.lng,j.lng)}}finally{v(!1)}};(0,n.useEffect)(()=>{_()},[]);let b=()=>{y(!1)},P=()=>{y(!1),o(w)},S=async(e,t)=>{new window.google.maps.Geocoder().geocode({location:{lat:e,lng:t}},(e,t)=>{"OK"===t?e[0]?p(e[0].formatted_address):p("No results found"):p("Geocoder failed due to: "+t)})},{isLoaded:k}=(0,u._)();return k?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Ay,{onClick:()=>{y(!0)},type:"link",icon:(0,a.jsx)(d.A,{}),size:"small",block:!1,style:{width:"max-content"},loading:x,children:x?"Getting Location...":"Open Map"}),(0,a.jsxs)(l.A,{title:"Map",open:m,onOk:b,onCancel:P,style:{top:20},width:800,footer:[(0,a.jsx)(i.Ay,{onClick:P,children:"Cancel"},"cancel"),(0,a.jsx)(i.Ay,{onClick:_,loading:x,children:"Retry Location"},"retry"),(0,a.jsx)(i.Ay,{type:"primary",onClick:b,children:"OK"},"ok")],children:[(0,a.jsx)(g,{markerState:r,setMarkerState:o,center:h,setCenterState:f,setPlaceName:p,geocodeLatLng:S}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Selected Place:"})," ",c]})]})]}):(0,a.jsx)("div",{children:"Map Loading...."})}function g(e){let{markerState:t,setMarkerState:r,center:s,setCenterState:i,setPlaceName:l,geocodeLatLng:d}=e,u=(0,n.useRef)(null);return(0,a.jsxs)(o.u6,{zoom:18,mapContainerStyle:p,center:s,onClick:e=>{let t=e.latLng.lat(),a=e.latLng.lng();r({lat:t,lng:a}),d(t,a)},children:[(0,a.jsx)(o.dj,{onLoad:e=>u.current=e,onPlacesChanged:()=>{let e=u.current.getPlaces();if(0===e.length)return;let t=e[0],a=t.geometry.location;r({lat:a.lat(),lng:a.lng()}),i({lat:a.lat(),lng:a.lng()}),l(t.formatted_address+" "+t.name)},children:(0,a.jsx)(c.A,{type:"text",placeholder:"Search location",style:{boxSizing:"border-box",border:"1px solid transparent",width:"240px",height:"32px",padding:"0 12px",borderRadius:"3px",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.3)",fontSize:"14px",outline:"none",textOverflow:"ellipses",position:"absolute",left:"50%",marginLeft:"-120px",top:"10px",zIndex:"10"}})}),(0,a.jsx)(o.X0,{position:t,onDragEnd:e=>{var t,a;let n=(null===(t=e.latLng)||void 0===t?void 0:t.lat())||0,o=(null===(a=e.latLng)||void 0===a?void 0:a.lng())||0;r({lat:n,lng:o}),d(n,o)},draggable:!0})]})}},19373:(e,t,r)=>{"use strict";r.d(t,{g:()=>n});var a=r(34477);let n=(0,a.createServerReference)("7f7177a3269b8d8c2c9a6ecaeea5051add2a3581c1",a.callServer,void 0,a.findSourceMapURL,"getSessionClient")},47827:(e,t,r)=>{Promise.resolve().then(r.bind(r,45626)),Promise.resolve().then(r.bind(r,48882)),Promise.resolve().then(r.bind(r,92672))},49561:(e,t,r)=>{"use strict";r.d(t,{f6:()=>u,th:()=>h,y1:()=>p});var a=r(23464),n=r(19373),o=r(10055),s=r(74227),i=r(49509);let l=i.env.NEXT_PUBLIC_API_URL,c=l+"/api/v1/",d=l+"/api/v2/",u=a.A.create({baseURL:c,headers:{"Content-Type":"application/json",accept:"application/json"}}),p=a.A.create({baseURL:c,headers:{"Content-Type":"application/json",accept:"application/json"}}),h=a.A.create({baseURL:d,headers:{"Content-Type":"application/json",accept:"application/json"}}),g=[p,a.A.create({baseURL:d,headers:{"Content-Type":"application/json",accept:"application/json"}})];[u,h].forEach(e=>{e.interceptors.response.use(e=>e.data,e=>e.response?Promise.reject(e.response.data.detail):Promise.reject(e.message))}),g.forEach(e=>{e.interceptors.request.use(async e=>{let t=await (0,n.g)();return e.headers.Authorization="Bearer ".concat(t.access_token?t.access_token:"no_token"),e},e=>Promise.reject(e))});let f=!1,m=null,y=[],x=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;y.forEach(r=>{let{resolve:a,reject:n,config:o}=r;e?n(e):(t&&(o.headers.Authorization="Bearer ".concat(t)),a(o))}),y=[]};g.forEach(e=>{e.interceptors.response.use(e=>e.data,async t=>{var r,a,s;let i=t.config;if((null===(r=t.response)||void 0===r?void 0:r.status)===401&&!i._retry){if(i._retry=!0,f)return new Promise((e,t)=>{y.push({resolve:e,reject:t,config:i})}).then(t=>e(t));m||(f=!0,m=v());try{if(!await m)return x("Session expired. Please login again."),await (0,o.l)(),Promise.reject("Session expired. Please login again.");{let t=await (0,n.g)();return i.headers.Authorization="Bearer ".concat(t.access_token),x(null,t.access_token),e(i)}}catch(e){return x("Authentication failed. Please login again."),await (0,o.l)(),Promise.reject("Authentication failed. Please login again.")}finally{setTimeout(()=>{m=null,f=!1},100)}}if(!t.response)return Promise.reject(t.message);{let e=t.response.status,r=(null===(a=t.response.data)||void 0===a?void 0:a.detail)||(null===(s=t.response.data)||void 0===s?void 0:s.message)||"An error occurred";return 403===e&&await (0,o.l)(),Promise.reject(r)}})});let v=async()=>{try{let e=await (0,n.g)();if(!(null==e?void 0:e.refresh_token))return await (0,o.l)(),!1;let t=i.env.NEXT_PUBLIC_API_URL;if(!t)throw Error("API URL is not defined");let r=await fetch("".concat(t,"/api/v1/refresh-token"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:e.refresh_token}),cache:"no-store"});if(!r.ok)return await (0,o.l)(),!1;let a=await r.json(),l={...e,access_token:a.access_token,refresh_token:a.refresh_token||e.refresh_token};return await (0,s.N)(l),!0}catch(e){return console.error("Token refresh failed:",e),await (0,o.l)(),!1}}},63086:e=>{e.exports={mainContainer:"username_mainContainer__D3saY",formContainer:"username_formContainer__lHoXr",h2:"username_h2__XzBNT"}},74227:(e,t,r)=>{"use strict";r.d(t,{N:()=>n});var a=r(34477);let n=(0,a.createServerReference)("7fbd64ebe47753c9152c4e6b30624382d1a35ef8f3",a.callServer,void 0,a.findSourceMapURL,"setSession")},92672:(e,t,r)=>{"use strict";r.d(t,{default:()=>A});var a=r(95155),n=r(34477);let o=(0,n.createServerReference)("7f1029bf6bbd5fbc9c8a47e783d7efed64b30c039c",n.callServer,void 0,n.findSourceMapURL,"removePhoneRegistration");var s=r(63086),i=r.n(s),l=r(15543),c=r(1228),d=r(12388),u=r(50274),p=r(97555),h=r(75584),g=r(5041),f=r(20534),m=r(94326),y=r(72070),x=r(17238),v=r(89584),j=r(77325),w=r(12115);let A=function(e){let{id:t}=e,r={lat:27.63820799904629,lng:85.51344372504178},n=(0,d.rd)(),[s]=f.A.useForm(),[A,_]=m.Ay.useMessage(),[b,P]=(0,w.useState)(r),[S,k]=(0,w.useState)(""),C=(0,g.n)({mutationFn:c.DY,onError:e=>{A.error(e.message)},onSuccess:async()=>{await o(),n.push("/login/")}}),E=[{required:!0,message:"Please confirm your password"},e=>{let{getFieldValue:t}=e;return{validator:(e,r)=>t("password")&&r===t("password")?Promise.resolve():Promise.reject(Error("Passwords do not match")),message:"Passwords do not match"}}];return(0,w.useEffect)(()=>{s.setFieldsValue({locName:S})},[S,s]),(0,a.jsxs)(a.Fragment,{children:[_,(0,a.jsx)("h2",{className:i().h2,children:"REGISTER YOUR ACCOUNT"}),(0,a.jsx)("br",{}),(0,a.jsxs)(f.A,{form:s,onFinish:e=>{let r={...e,phone_number:t[1],country_code:t[0],location:{name:S,latitude:b.lat,longitude:b.lng}};C.mutate({...r})},layout:"vertical",size:"middle",children:[(0,a.jsx)(f.A.Item,{rules:[{required:!0,message:"Please enter your name!"}],required:!0,name:"full_name",label:" Full Name",children:(0,a.jsx)(y.A,{prefix:(0,a.jsx)(u.A,{})})}),(0,a.jsxs)(x.A,{vertical:!0,justify:"start",children:[(0,a.jsx)(f.A.Item,{required:!0,rules:[{required:!0,message:"Please select a Location"}],style:{marginBottom:"5px"},name:"locName",label:"Location",children:(0,a.jsx)(y.A,{disabled:!0,placeholder:"Enter your Event Venue"})}),(0,a.jsx)(l.A,{centerCoords:r,markerState:b,setMarkerState:P,placeName:S,setPlaceName:k})]}),(0,a.jsx)(f.A.Item,{rules:[{required:!0,message:"Please enter your address!"}],required:!0,name:"language_pref",label:"Select Your Preferred Language",children:(0,a.jsx)(v.A,{placeholder:"Select Your Language",options:[{label:"Nepali",value:"nepali"},{label:"English",value:"english"}]})}),(0,a.jsx)(f.A.Item,{rules:[{required:!0,message:"Please enter your username!"}],required:!0,name:"email",label:" Email",children:(0,a.jsx)(y.A,{prefix:(0,a.jsx)(p.A,{})})}),(0,a.jsx)(f.A.Item,{rules:[{required:!0,message:"Please enter your password!"}],required:!0,name:"password",label:"Password",hasFeedback:!0,children:(0,a.jsx)(y.A.Password,{prefix:(0,a.jsx)(h.A,{})})}),(0,a.jsx)(f.A.Item,{hasFeedback:!0,required:!0,name:"confirm",rules:E,label:"Confirm your Password",children:(0,a.jsx)(y.A.Password,{prefix:(0,a.jsx)(h.A,{})})}),(0,a.jsx)(j.Ay,{loading:C.isPending,block:!0,type:"primary",htmlType:"submit",children:"Send"})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[1933,6084,4666,6449,6327,3876,8646,8085,7325,6922,6874,9186,7845,5144,2788,3889,534,4714,9584,6002,2070,2938,9193,4126,8441,1684,7358],()=>t(47827)),_N_E=e.O()}]);