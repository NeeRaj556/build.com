(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6683],{39341:()=>{},56683:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>H});var n=l(95155),a=l(79659),i=l(81535),r=l(77325),s=l(85189),o=l(35440),d=l(12115),c=l(37579),u=l(36768);let h=(0,d.forwardRef)((e,t)=>{let{template:l,selectedElementIndex:a,setSelectedElementIndex:i,updateContent:r,readOnly:s=!1}=e,[o,h]=(0,d.useState)(null),[m,g]=(0,d.useState)(!1),x=(0,d.useRef)(null),A=(0,d.useRef)([]),b=(0,d.useRef)(null);(0,d.useEffect)(()=>{A.current=A.current.slice(0,l.contents.length)},[l.contents.length]),(0,d.useImperativeHandle)(t,()=>({captureImage:()=>x.current?x.current.toDataURL({pixelRatio:2,mimeType:"image/jpeg",quality:.9}):null}));let p=(0,d.useCallback)((e,t,n,a)=>({x:Math.floor(Math.max(0,Math.min(e,l.width-n))),y:Math.floor(Math.max(0,Math.min(t,l.height-a)))}),[l.width,l.height]);(0,d.useEffect)(()=>{if(l.background_image){let e=new Image;if(e.crossOrigin="anonymous",e.onload=()=>h(e),e.onerror=e=>{console.error("Image load error:",e),h(null)},l.background_image instanceof File){let t=URL.createObjectURL(l.background_image);return e.src=t,()=>URL.revokeObjectURL(t)}if("string"==typeof l.background_image){let t=l.background_image.includes("?")?"&":"?";e.src="/api/image-proxy?url=".concat(encodeURIComponent(l.background_image)).concat(t,"cache=").concat(Date.now())}}else h(null)},[l.background_image]);let j=(0,d.useCallback)(e=>{let t=e.target;"Stage"!==t.getType()&&t!==b.current||m||i(null)},[m,i]),y=(0,d.useCallback)((e,t)=>{console.log("Text clicked:",t),e.cancelBubble=!0,e.evt&&(e.evt.preventDefault(),e.evt.stopPropagation()),s||i(t)},[s,i]),v=(0,d.useCallback)((e,t)=>{var l;if(s)return;console.log("Drag start:",t),g(!0),i(t);let n=null===(l=e.target.getStage())||void 0===l?void 0:l.container();n&&(n.style.cursor="grabbing")},[s,i]),f=(0,d.useCallback)(e=>{if(s)return;let t=e.target,l=t.width(),n=t.height(),a=p(t.x(),t.y(),l,n);t.x(a.x),t.y(a.y)},[s,p]),k=(0,d.useCallback)((e,t)=>{var l;if(s)return;console.log("Drag end:",t);let n=e.target,a=n.width(),i=n.height(),o=p(n.x(),n.y(),a,i);r(t,{x:o.x,y:o.y}),setTimeout(()=>{g(!1)},50);let d=null===(l=e.target.getStage())||void 0===l?void 0:l.container();d&&(d.style.cursor="default")},[s,p,r]),_=(0,d.useCallback)((e,t)=>{var l;if(s)return;let n=null===(l=e.target.getStage())||void 0===l?void 0:l.container();n&&!m&&(n.style.cursor=a===t?"grab":"pointer")},[s,m,a]),C=(0,d.useCallback)(e=>{var t;let l=null===(t=e.target.getStage())||void 0===t?void 0:t.container();l&&!m&&(l.style.cursor="default")},[m]);return l?(0,n.jsx)("div",{className:"stage-container",children:(0,n.jsx)(c.BI,{width:l.width,height:l.height,ref:x,onMouseDown:j,onTouchStart:j,style:{background:"rgb(236, 236, 236)",boxShadow:"0 0 10px rgba(104, 104, 104, 0.1)",margin:"0 auto",width:l.width,height:l.height},children:(0,n.jsxs)(c.Wd,{ref:b,children:[o&&(0,n.jsx)(c._V,{image:o,width:l.width,height:l.height,listening:!1}),l.contents.map((e,t)=>{var l;let r=A.current[t];return(0,n.jsxs)(d.Fragment,{children:[(0,n.jsx)(c.EY,{ref:e=>{e&&(A.current[t]=e)},text:e.value||"Text",x:e.x||0,y:e.y||0,fontSize:e.font_size||e.size||16,fontFamily:e.font_family||"Arial",fill:(null===(l=e.color)||void 0===l?void 0:l.startsWith("#"))?e.color:"#".concat(e.color||"000000"),fontStyle:"".concat(e.is_bold?"bold":""," ").concat(e.is_italic?"italic":"").trim()||"normal",stroke:e.has_border?"#000000":void 0,strokeWidth:+!!e.has_border,draggable:!s,listening:!0,onMouseDown:e=>y(e,t),onTouchStart:e=>y(e,t),onClick:e=>{e.cancelBubble=!0,s||m||i(t)},onTap:e=>{e.cancelBubble=!0,s||m||i(t)},onDragStart:e=>v(e,t),onDragMove:f,onDragEnd:e=>k(e,t),onMouseEnter:e=>_(e,t),onMouseLeave:C,perfectDrawEnabled:!1,shadowForStrokeEnabled:!1}),a===t&&r&&(0,n.jsx)(c.rw,{x:(e.x||0)-5,y:(e.y||0)-5,width:r.width()+10,height:r.height()+10,stroke:"#1890ff",strokeWidth:2,dash:[4,4],listening:!1,cornerRadius:3})]},"text-element-".concat(t,"-").concat(e.value))})]})})}):(0,n.jsx)(u.A,{description:"No template selected"})});h.displayName="CanvasEditor";var m=l(76714),g=l(56170),x=l(13921),A=l(46996),b=l(65927),p=l(33943),j=l(20890),y=l(19558),v=l(19373),f=l(35125),k=l(20534),_=l(72070),C=l(97226),w=l(31506),S=l(66188),I=l(89584),T=l(13324),E=l(82164),R=l(26922),U=l(94600),z=l(17238),B=l(37974);let L=["ABeeZee","Abel","Abhaya Libre","Tangerine","Aboreto","Abril Fatface","Abyssinica SIL","Aclonica","Acme","Actor","Adamina","Advent Pro","Aguafina Script","Akaya Kanadaka","Akaya Telivigala","Akronim","Akshar","Aladin","Alata","Alatsi","Albert Sans","Aldrich","Alef","Alegreya","Alegreya SC","Alegreya Sans","Alegreya Sans SC","Aleo","Alex Brush","Alexandria","Alfa Slab One","Alice","Alike","Alike Angular","Alkalami","Allan","Allerta","Allerta Stencil","Allison","Allura","Almarai","Almendra","Almendra Display","Almendra SC","Alumni Sans","Alumni Sans Collegiate One","Alumni Sans Inline One","Alumni Sans Pinstripe","Amarante","Amaranth","Amatic SC","Amethysta","Amiko","Amiri","Amiri Quran","Amita","Anaheim","Andada Pro","Andika","Anek Bangla","Anek Devanagari","Anek Gujarati","Anek Gurmukhi","Anek Kannada","Anek Latin","Anek Malayalam","Anek Odia","Anek Tamil","Anek Telugu","Angkor","Annie Use Your Telescope","Anonymous Pro","Antic","Antic Didone","Antic Slab","Anton","Antonio","Anybody","Arapey"],{Title:D,Text:F}=i.A,{TabPane:M}=f.A,N=e=>L.map(t=>({value:t,label:(0,n.jsx)("span",{style:{fontFamily:t},children:e})})),P=e=>{let{template:t,updateTemplate:l,selectedElementIndex:a,updateContent:i,selectedContent:s,addContent:o,removeContent:d,handleBackgroundUpload:c,handleSave:u,readOnly:h=!1,setSelectedElementIndex:L,handleThumbnailUpload:P,loading:O,isUser:W}=e,{data:H,isLoading:K}=(0,v.I)({queryKey:["categories"],queryFn:m.LZ}),Y=(e,t)=>!!e.type.startsWith("image/")&&("background"===t&&c(e),"thumbnail"===t&&P(e),!1);return(0,n.jsxs)("div",{className:"control-panel-content",children:[(0,n.jsxs)(f.A,{defaultActiveKey:"canvas",className:"control-tabs",children:[!W&&(0,n.jsx)(M,{tab:"Canvas",children:(0,n.jsxs)(k.A,{layout:"vertical",children:[(0,n.jsx)(k.A.Item,{label:"Title",children:(0,n.jsx)(_.A,{value:t.title,onChange:e=>l("title",e.target.value),disabled:h})}),(0,n.jsx)(k.A.Item,{label:"Canvas Size",children:(0,n.jsxs)(C.A,{children:[(0,n.jsx)(w.A,{addonBefore:"Width",min:200,max:3e3,value:t.width,onChange:e=>l("width",e),disabled:h}),(0,n.jsx)(w.A,{addonBefore:"Height",min:200,max:3e3,value:t.height,onChange:e=>l("height",e),disabled:h})]})}),(0,n.jsx)(k.A.Item,{label:"Background",children:(0,n.jsx)(S.A,{name:"background",listType:"picture-card",showUploadList:!1,beforeUpload:e=>Y(e,"background"),disabled:h,children:t.background_image?(0,n.jsxs)("div",{style:{position:"relative"},children:[(0,n.jsx)("img",{src:"string"==typeof t.background_image?t.background_image:URL.createObjectURL(t.background_image),alt:"Background",style:{width:"100%"}}),(0,n.jsx)("div",{style:{position:"absolute",top:0,right:0,background:"rgba(0,0,0,0.65)",color:"#fff",cursor:"pointer",padding:"4px"},onClick:e=>{e.stopPropagation(),l("background_image",null)},children:(0,n.jsx)(g.A,{})})]}):(0,n.jsxs)("div",{children:[(0,n.jsx)(x.A,{}),(0,n.jsx)("div",{style:{marginTop:8},children:"Upload"})]})})}),(0,n.jsx)(k.A.Item,{label:"Thumbnail",children:(0,n.jsx)(S.A,{name:"thumbnail",listType:"picture-card",showUploadList:!1,beforeUpload:e=>Y(e,"thumbnail"),disabled:h,children:t.thumbnail_url?(0,n.jsxs)("div",{style:{position:"relative"},children:[(0,n.jsx)("img",{src:"string"==typeof t.thumbnail_url?t.thumbnail_url:URL.createObjectURL(t.thumbnail_url),alt:"thumbnail",style:{width:"100%"}}),(0,n.jsx)("div",{style:{position:"absolute",top:0,right:0,background:"rgba(0,0,0,0.65)",color:"#fff",cursor:"pointer",padding:"4px"},onClick:e=>{e.stopPropagation(),l("thumbnail_url",null)},children:(0,n.jsx)(g.A,{})})]}):(0,n.jsxs)("div",{children:[(0,n.jsx)(x.A,{}),(0,n.jsx)("div",{style:{marginTop:8},children:"Upload"})]})})}),(0,n.jsx)(k.A.Item,{label:"Template Type",children:(0,n.jsx)(I.A,{popupMatchSelectWidth:!1,loading:K,options:null==H?void 0:H.map(e=>({value:e.id,label:e.name})),onChange:e=>l("category_id",e)})}),(0,n.jsx)(k.A.Item,{label:"Description",children:(0,n.jsx)(_.A.TextArea,{value:t.description||"",onChange:e=>l("description",e.target.value),rows:3,disabled:h})}),(0,n.jsx)(k.A.Item,{children:(0,n.jsxs)(C.A,{children:[(0,n.jsx)(T.A,{checked:t.is_public,onChange:e=>l("is_public",e),disabled:h}),(0,n.jsx)(F,{children:"Public"})]})}),(0,n.jsx)(k.A.Item,{children:(0,n.jsxs)(C.A,{children:[(0,n.jsx)(T.A,{checked:t.is_premium,onChange:e=>l("is_premium",e),disabled:h}),(0,n.jsx)(F,{children:"Premium"})]})}),t.is_premium&&(0,n.jsx)(k.A.Item,{label:"Price in Credits",children:(0,n.jsx)(w.A,{min:0,value:t.price_in_credits,onChange:e=>l("price_in_credits",e),disabled:h,style:{width:"100%"}})})]})},"canvas"),(0,n.jsxs)(M,{tab:"Text Elements",children:[!W&&!h&&(0,n.jsx)(r.Ay,{type:"dashed",icon:(0,n.jsx)(A.A,{}),onClick:()=>o(),block:!0,style:{marginBottom:16},children:"Add Text"}),null!==a&&s&&(0,n.jsxs)(k.A,{layout:"vertical",children:[(0,n.jsx)(D,{level:5,children:"Edit Text Element"}),(0,n.jsx)(r.Ay,{style:{width:"100%",marginBottom:12},onClick:()=>L(null),children:"Remove selection"}),(0,n.jsx)(k.A.Item,{label:"Text Content",children:(0,n.jsx)(_.A.TextArea,{value:s.value,onChange:e=>i(a,{value:e.target.value}),rows:3,disabled:h})}),(0,n.jsx)(k.A.Item,{label:"Position",children:(0,n.jsxs)(C.A,{children:[(0,n.jsx)(w.A,{addonBefore:"X",value:s.x,onChange:e=>i(a,{x:e}),disabled:h}),(0,n.jsx)(w.A,{addonBefore:"Y",value:s.y,onChange:e=>i(a,{y:e}),disabled:h})]})}),(0,n.jsx)(k.A.Item,{label:"Font",children:(0,n.jsx)(I.A,{value:s.font_family,onChange:e=>i(a,{font_family:e}),disabled:h,style:{width:"100%"},options:N(s.value)})}),(0,n.jsx)(k.A.Item,{label:"Font Size",children:(0,n.jsx)(w.A,{min:8,max:120,value:s.font_size||s.size,onChange:e=>i(a,{font_size:e,size:e}),disabled:h,style:{width:"100%"}})}),(0,n.jsx)(k.A.Item,{label:"Color",children:(0,n.jsx)(E.A,{value:s.color,onChange:e=>i(a,{color:e.toHex()}),disabled:h})}),(0,n.jsx)(k.A.Item,{children:(0,n.jsxs)(C.A,{children:[(0,n.jsx)(R.A,{title:"Bold",children:(0,n.jsx)(r.Ay,{icon:(0,n.jsx)(b.A,{}),type:s.is_bold?"primary":"default",onClick:()=>i(a,{is_bold:!s.is_bold}),disabled:h})}),(0,n.jsx)(R.A,{title:"Italic",children:(0,n.jsx)(r.Ay,{icon:(0,n.jsx)(p.A,{}),type:s.is_italic?"primary":"default",onClick:()=>i(a,{is_italic:!s.is_italic}),disabled:h})}),(0,n.jsx)(R.A,{title:"Border",children:(0,n.jsx)(r.Ay,{icon:(0,n.jsx)(j.A,{}),type:s.has_border?"primary":"default",onClick:()=>i(a,{has_border:!s.has_border}),disabled:h})})]})}),!W&&!h&&(0,n.jsx)(r.Ay,{danger:!0,icon:(0,n.jsx)(g.A,{}),onClick:()=>d(a),block:!0,children:"Remove Element"})]}),null===a&&t.contents.length>0&&(0,n.jsxs)("div",{className:"elements-list",children:[(0,n.jsx)(D,{level:5,children:"Select Element to Edit"}),t.contents.map((e,t)=>(0,n.jsx)("div",{className:"element-item",onClick:()=>L(t),children:(0,n.jsx)(F,{ellipsis:!0,style:{width:"100%"},children:e.value||"Empty text"})},t))]})]},"elements")]}),(0,n.jsx)(U.A,{style:{margin:"12px 0"}}),W&&null!==a?(0,n.jsx)(z.A,{className:"warning-message",justify:"center",children:(0,n.jsx)(B.A,{color:"red",children:"Remove Selection to continue"})}):(0,n.jsx)(r.Ay,{type:"primary",icon:W?(0,n.jsx)(n.Fragment,{}):(0,n.jsx)(y.A,{}),onClick:u,block:!0,disabled:W&&null!==a,loading:O,children:W?"Next":h?"Use Template":"Save Template"})]})};l(39341);let{Title:O}=i.A,W={title:"",subtitle:"",description:"",category_id:0,height:600,width:800,contents:[],is_public:!1,is_premium:!1,is_active:!0,background_image:null,price_in_credits:0,template_type:"",id:0,user_id:0,created_at:"",preview_images:[]},H=(0,d.forwardRef)((e,t)=>{let{initialTemplate:l={},onSave:i=()=>{},readOnly:c=!1,isUser:u=!1,loading:m=!1}=e,[g,x]=(0,d.useState)({...W,...{...l,background_image:null==l?void 0:l.file_url}}),A=(0,d.useRef)(null);(0,d.useImperativeHandle)(t,()=>({captureImage:()=>A.current?A.current.captureImage():null}));let[b,p]=(0,d.useState)(null),[j,y]=(0,d.useState)(window.innerWidth),[v,f]=(0,d.useState)(!1);(0,d.useEffect)(()=>{let e=()=>{y(window.innerWidth)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let k=(e,t)=>{x(l=>{let n=[...l.contents];return n[e]={...n[e],...t},{...l,contents:n}})},_=(0,n.jsx)(P,{isUser:u,handleThumbnailUpload:e=>{e&&x(t=>({...t,thumbnail_url:e}))},setSelectedElementIndex:p,template:g,updateTemplate:(e,t)=>{x(l=>({...l,[e]:t}))},selectedElementIndex:b,updateContent:k,selectedContent:null!==b?g.contents[b]:null,addContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={value:"New Text",x:50,y:50,font_family:"Arial",color:"#000000",size:16,is_bold:!1,is_italic:!1,has_border:!1,font_size:16,...e};x(e=>({...e,contents:[...e.contents,t]})),p(g.contents.length)},removeContent:e=>{x(t=>({...t,contents:t.contents.filter((t,l)=>l!==e)})),b===e&&p(null)},handleBackgroundUpload:e=>{e&&x(t=>({...t,background_image:e}))},handleSave:()=>{try{i(g)}catch(e){console.error("Failed to save template")}},readOnly:c,loading:m}),C=(0,n.jsx)(r.Ay,{type:"primary",shape:"circle",icon:(0,n.jsx)(a.A,{}),size:"large",onClick:()=>f(!0),style:{position:"fixed",bottom:180,right:24,zIndex:1e3,boxShadow:"0 3px 6px rgba(0,0,0,0.16)"}});return(0,n.jsx)(n.Fragment,{children:j<=768?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(h,{ref:A,template:g,selectedElementIndex:b,setSelectedElementIndex:p,updateContent:k,readOnly:c}),(0,n.jsx)(s.A,{title:"Template Editor",placement:"right",onClose:()=>f(!1),open:v,width:320,children:_}),C]}):(0,n.jsxs)(o.A,{style:{boxShadow:"0 0 10px rgba(0, 0, 0, 0.1)"},children:[(0,n.jsx)(o.A.Panel,{min:"25%",children:(0,n.jsx)(h,{ref:A,template:g,selectedElementIndex:b,setSelectedElementIndex:p,updateContent:k,readOnly:c})}),(0,n.jsx)(o.A.Panel,{defaultSize:"25%",resizable:!1,collapsible:!0,max:"25%",className:"",children:(0,n.jsxs)("div",{style:{padding:"1rem",overflowY:"auto",height:g.height},children:[(0,n.jsx)(O,{style:{textAlign:"center"},level:4,children:"Customize your template"}),_]})})]})})})}}]);