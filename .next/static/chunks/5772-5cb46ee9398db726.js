(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5772],{1228:(e,r,t)=>{"use strict";t.d(r,{DY:()=>o,Sk:()=>c,_h:()=>i,ec:()=>l,iS:()=>a,p7:()=>s});var n=t(49561);async function s(e){try{return await n.f6.post("login/phone-number",e)}catch(e){throw Error(e)}}async function a(e){try{return await n.f6.post("verify-phone-number",e)}catch(e){throw Error(e)}}async function i(e){try{return await n.f6.post("login/access-token",e,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}catch(e){throw Error(e)}}async function o(e){try{return await n.f6.post("users/",e)}catch(e){throw Error(e)}}async function c(){try{return await n.y1.get("users/me/")}catch(e){throw Error(e)}}async function l(e){try{return await n.y1.post("change-password",e)}catch(e){throw Error(e)}}},1828:e=>{e.exports={mainContainer:"phone_mainContainer__Vnjz2",formContainer:"phone_formContainer__xy_3U",h2:"phone_h2__yu3pp",errorDiv:"phone_errorDiv__XwZoe"}},1864:(e,r,t)=>{"use strict";t.d(r,{g:()=>s});var n=t(34477);let s=(0,n.createServerReference)("7fed69ea85d4db6ea3047c23cdfcb63fa4279d6595",n.callServer,void 0,n.findSourceMapURL,"getSessionClient")},5772:(e,r,t)=>{"use strict";t.d(r,{default:()=>C});var n=t(95155),s=t(34477);let a=(0,s.createServerReference)("402ec0bcc437b84aff2c231076fbab56896f4a1b5f",s.callServer,void 0,s.findSourceMapURL,"handlePhoneRegistration");var i=t(20196),o=t(1864),c=t(88800),l=t(1228),d=t(12388),u=t(85359),p=t(5041),h=t(20534),m=t(70445),y=t(17238),f=t(72070),j=t(82343),x=t(97226),g=t(19361),b=t(74947),v=t(77325),A=t(59376),S=t(24848),w=t(95891),_=t(95233),k=t(60760),F=t(39545),E=t(12115),R=t(1828),N=t.n(R);let P=[{code:"+81",name:"Japan"},{code:"+61",name:"Australia"},{code:"+977",name:"Nepal"}];function C(){let e=(0,d.a8)(),[r,t]=(0,S.A)(),s=(0,d.rd)(),[R,C]=(0,E.useState)({phone_number:""}),[L,T]=(0,E.useState)(),[U]=h.A.useForm(),[M]=h.A.useForm(),[z,I]=(0,E.useState)("+977"),{token:{colorTextSecondary:q}}=m.A.useToken(),D=P.map(e=>({key:e.code,label:(0,n.jsxs)(y.A,{gap:10,justify:"space-between",children:[(0,n.jsx)(w.A,{style:{color:q},children:e.name}),(0,n.jsxs)(w.A,{style:{color:q},children:[" ",e.code]})]})})),B=(0,p.n)({mutationFn:l.p7,onError:e=>{M.setFields([{name:"phone_number",errors:[e.message]}]),r.error(e.message)},onSuccess:async e=>{T(e.user_type),"new"===e.user_type&&await a("".concat(z,"&").concat(R.phone_number))}}),G=(0,p.n)({mutationFn:l.iS,onError:e=>{U.setFields([{name:"otp",errors:[e.message]}])},onSuccess:async e=>{if("registered"===L){var r;await (0,i.N)({...e,isLoggedIn:!0});let t=await (0,o.g)();(0,c.S)(null===(r=t.user)||void 0===r?void 0:r.user_role)}else await (0,i.N)({...e,isLoggedIn:!1}),s.push("/register/user-details")}}),J={hidden:{opacity:0,x:-100,transition:{duration:.5,ease:_.am}},enter:{opacity:1,x:0,transition:{duration:.5,ease:_.am}},exit:{opacity:0,x:100,transition:{duration:.5,ease:_.am}}};return(0,n.jsxs)(n.Fragment,{children:[t,(0,n.jsxs)(k.N,{mode:"wait",initial:!1,children:[!B.isSuccess&&(0,n.jsxs)(F.P.div,{variants:J,initial:"hidden",animate:"enter",exit:"exit",transition:{type:"linear"},children:[(0,n.jsxs)(h.A,{form:M,layout:"vertical",onFinish:e=>{C(e),B.mutate({...e,country_code:z})},size:"large",children:[(0,n.jsx)(h.A.Item,{label:"Enter your mobile number",name:"phone_number",rules:[{required:!0,message:"Please enter your phone number!"},{}],children:(0,n.jsx)(f.A,{onFocus:()=>{B.reset(),M.setFields([{name:"phone_number",errors:[]}])},value:"".concat(R),prefix:(0,n.jsx)(j.A,{menu:{items:D,selectable:!0,defaultSelectedKeys:[z],onSelect:e=>{I(e.key)},style:{color:q}},arrow:!1,children:(0,n.jsx)(w.A,{children:(0,n.jsxs)(x.A,{style:{color:q},children:[z,(0,n.jsx)(u.A,{})]})})})})}),(0,n.jsxs)(g.A,{gutter:[0,10],children:[(0,n.jsx)(b.A,{span:24,children:"/login/phone"===e?(0,n.jsxs)(y.A,{justify:"space-between",gap:20,wrap:"wrap",children:[(0,n.jsx)(v.Ay,{type:"link",style:{padding:"0"},children:(0,n.jsx)(d.N_,{href:"/register",children:"Register New Account"})}),(0,n.jsx)(v.Ay,{type:"link",style:{padding:"0"},children:(0,n.jsx)(d.N_,{href:"/login/username",children:"Login with email"})})]}):(0,n.jsx)(v.Ay,{type:"link",style:{padding:"0"},children:(0,n.jsx)(d.N_,{href:"/login/phone",children:"Already have an account? Sign in"})})}),(0,n.jsx)(b.A,{span:24,children:(0,n.jsx)(v.Ay,{loading:B.isPending,danger:B.isError,htmlType:"submit",block:!0,type:"primary",children:"Submit"})})]})]}),(0,n.jsx)("br",{})]},"phone-form"),B.isSuccess&&(0,n.jsxs)(F.P.div,{variants:J,initial:"hidden",animate:"enter",exit:"exit",transition:{type:"linear"},children:[(0,n.jsx)("br",{}),(0,n.jsx)("h3",{className:N().h2,children:"Enter the otp sent to your device"}),(0,n.jsx)("br",{}),(0,n.jsxs)(h.A,{size:"large",form:U,onFinish:e=>{let r=e.otp.join("");G.mutate({...R,otp:r})},children:[(0,n.jsx)(h.A.Item,{style:{width:"max-content"},name:"otp",rules:[{required:!0,message:"Please enter your OTP!"}],children:(0,n.jsx)(A.U,{onFocus:G.reset,autoFocus:!0,autoSubmit:U,inputType:"numeric"})}),(0,n.jsxs)(g.A,{gutter:[0,10],children:[(0,n.jsx)(b.A,{span:24,children:(0,n.jsx)(g.A,{justify:"end",children:(0,n.jsx)(v.Ay,{type:"link",style:{padding:"0"},onClick:()=>{G.reset(),B.reset(),U.resetFields(),U.setFields([{name:"otp",errors:void 0}])},children:"Go back"})})}),(0,n.jsx)(b.A,{span:24,children:(0,n.jsx)(v.Ay,{loading:G.isPending,danger:G.isError,htmlType:"submit",type:"primary",block:!0,children:"Submit"})})]})]})]},"otp-form")]})]})}},12388:(e,r,t)=>{"use strict";t.d(r,{N_:()=>i,a8:()=>c,rd:()=>l});var n=t(47830),s=t(43089);let a=(0,n.o)({locales:["en","nep"],defaultLocale:"en"}),{Link:i,redirect:o,usePathname:c,useRouter:l,getPathname:d}=(0,s.xp)(a)},20196:(e,r,t)=>{"use strict";t.d(r,{N:()=>s});var n=t(34477);let s=(0,n.createServerReference)("7f24de6dc75e176a5c64d533f2124aedc722a7d474",n.callServer,void 0,n.findSourceMapURL,"setSession")},28720:(e,r,t)=>{"use strict";t.d(r,{l:()=>s});var n=t(34477);let s=(0,n.createServerReference)("7f8058f04b6e3f5ba75d4418f9fef5ecdc215a0ae0",n.callServer,void 0,n.findSourceMapURL,"destroySession")},49561:(e,r,t)=>{"use strict";t.d(r,{f6:()=>o,y1:()=>c});var n=t(23464),s=t(1864),a=t(28720);let i="https://backend.enimto.com/api/v1/",o=n.A.create({baseURL:i,headers:{"Content-Type":"application/json",accept:"application/json"}});o.interceptors.response.use(e=>e.data,e=>e.response?Promise.reject(e.response.data.detail):Promise.reject(e.message));let c=n.A.create({baseURL:i,headers:{"Content-Type":"application/json",accept:"application/json"}});c.interceptors.request.use(async e=>{let r=await (0,s.g)();return e.headers.Authorization="Bearer ".concat(r.access_token?r.access_token:"no_token"),e},e=>Promise.reject(e)),c.interceptors.response.use(e=>e.data,async e=>{if(!e.response)return Promise.reject(e.message);{let r=e.response.status,t=e.response.data.detail;return(403===r||401===r)&&await (0,a.l)(),Promise.reject(t)}})},88800:(e,r,t)=>{"use strict";t.d(r,{S:()=>s});var n=t(34477);let s=(0,n.createServerReference)("7f595dd1f91f174e174e7ded5ccff9018265f9f962",n.callServer,void 0,n.findSourceMapURL,"redirectTo")}}]);