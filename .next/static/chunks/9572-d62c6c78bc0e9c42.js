(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9572],{1228:(e,r,t)=>{"use strict";t.d(r,{DY:()=>o,Sk:()=>c,_h:()=>i,ec:()=>l,iS:()=>s,p7:()=>a});var n=t(49561);async function a(e){try{return await n.f6.post("login/phone-number",e)}catch(e){throw Error(e)}}async function s(e){try{return await n.f6.post("verify-phone-number",e)}catch(e){throw Error(e)}}async function i(e){try{return await n.th.post("login",e,{headers:{"Content-Type":"application/json"}})}catch(e){throw Error(e)}}async function o(e){try{return await n.f6.post("users/",e)}catch(e){throw Error(e)}}async function c(){try{return await n.y1.get("users/me/")}catch(e){throw Error(e)}}async function l(e){try{return await n.y1.post("change-password",e)}catch(e){throw Error(e)}}},1828:e=>{e.exports={mainContainer:"phone_mainContainer__Vnjz2",formContainer:"phone_formContainer__xy_3U",h2:"phone_h2__yu3pp",errorDiv:"phone_errorDiv__XwZoe"}},12388:(e,r,t)=>{"use strict";t.d(r,{N_:()=>i,a8:()=>c,rd:()=>l});var n=t(47830),a=t(43089);let s=(0,n.o)({locales:["en","nep"],defaultLocale:"en"}),{Link:i,redirect:o,usePathname:c,useRouter:l,getPathname:d}=(0,a.xp)(s)},39572:(e,r,t)=>{"use strict";t.d(r,{default:()=>T});var n=t(95155),a=t(34477);let s=(0,a.createServerReference)("4000a122ea2cc70bb753247e64fd726f9f01fd96a1",a.callServer,void 0,a.findSourceMapURL,"handlePhoneRegistration");var i=t(72508),o=t(66608),c=t(49943),l=t(1228),d=t(12388),u=t(85359),p=t(5041),h=t(20534),f=t(70445),y=t(17238),m=t(72070),g=t(82343),j=t(97226),v=t(19361),x=t(74947),_=t(77325),b=t(59376),A=t(24848),w=t(95891),S=t(95233),k=t(60760),P=t(39545),E=t(12115),R=t(1828),L=t.n(R);let N=[{code:"+81",name:"Japan"},{code:"+61",name:"Australia"},{code:"+977",name:"Nepal"}];function T(){let e=(0,d.a8)(),[r,t]=(0,A.A)(),a=(0,d.rd)(),[R,T]=(0,E.useState)({phone_number:""}),[C,U]=(0,E.useState)(),[F]=h.A.useForm(),[I]=h.A.useForm(),[z,B]=(0,E.useState)("+977"),{token:{colorTextSecondary:M}}=f.A.useToken(),q=N.map(e=>({key:e.code,label:(0,n.jsxs)(y.A,{gap:10,justify:"space-between",children:[(0,n.jsx)(w.A,{style:{color:M},children:e.name}),(0,n.jsxs)(w.A,{style:{color:M},children:[" ",e.code]})]})})),D=(0,p.n)({mutationFn:l.p7,onError:e=>{I.setFields([{name:"phone_number",errors:[e.message]}]),r.error(e.message)},onSuccess:async e=>{U(e.user_type),"new"===e.user_type&&await s("".concat(z,"&").concat(R.phone_number))}}),O=(0,p.n)({mutationFn:l.iS,onError:e=>{F.setFields([{name:"otp",errors:[e.message]}])},onSuccess:async e=>{if("registered"===C){var r;await (0,i.N)({...e,isLoggedIn:!0});let t=await (0,o.g)();(0,c.S)(null===(r=t.user)||void 0===r?void 0:r.user_role)}else await (0,i.N)({...e,isLoggedIn:!1}),a.push("/register/user-details")}}),X={hidden:{opacity:0,x:-100,transition:{duration:.5,ease:S.am}},enter:{opacity:1,x:0,transition:{duration:.5,ease:S.am}},exit:{opacity:0,x:100,transition:{duration:.5,ease:S.am}}};return(0,n.jsxs)(n.Fragment,{children:[t,(0,n.jsxs)(k.N,{mode:"wait",initial:!1,children:[!D.isSuccess&&(0,n.jsxs)(P.P.div,{variants:X,initial:"hidden",animate:"enter",exit:"exit",transition:{type:"linear"},children:[(0,n.jsxs)(h.A,{form:I,layout:"vertical",onFinish:e=>{T(e),D.mutate({...e,country_code:z})},size:"large",children:[(0,n.jsx)(h.A.Item,{label:"Enter your mobile number",name:"phone_number",rules:[{required:!0,message:"Please enter your phone number!"},{}],children:(0,n.jsx)(m.A,{onFocus:()=>{D.reset(),I.setFields([{name:"phone_number",errors:[]}])},value:"".concat(R),prefix:(0,n.jsx)(g.A,{menu:{items:q,selectable:!0,defaultSelectedKeys:[z],onSelect:e=>{B(e.key)},style:{color:M}},arrow:!1,children:(0,n.jsx)(w.A,{children:(0,n.jsxs)(j.A,{style:{color:M},children:[z,(0,n.jsx)(u.A,{})]})})})})}),(0,n.jsxs)(v.A,{gutter:[0,10],children:[(0,n.jsx)(x.A,{span:24,children:"/login/phone"===e?(0,n.jsxs)(y.A,{justify:"space-between",gap:20,wrap:"wrap",children:[(0,n.jsx)(_.Ay,{type:"link",style:{padding:"0"},children:(0,n.jsx)(d.N_,{href:"/register",children:"Register New Account"})}),(0,n.jsx)(_.Ay,{type:"link",style:{padding:"0"},children:(0,n.jsx)(d.N_,{href:"/login/username",children:"Login with email"})})]}):(0,n.jsx)(_.Ay,{type:"link",style:{padding:"0"},children:(0,n.jsx)(d.N_,{href:"/login/",children:"Already have an account? Sign in"})})}),(0,n.jsx)(x.A,{span:24,children:(0,n.jsx)(_.Ay,{loading:D.isPending,danger:D.isError,htmlType:"submit",block:!0,type:"primary",children:"Submit"})})]})]}),(0,n.jsx)("br",{})]},"phone-form"),D.isSuccess&&(0,n.jsxs)(P.P.div,{variants:X,initial:"hidden",animate:"enter",exit:"exit",transition:{type:"linear"},children:[(0,n.jsx)("br",{}),(0,n.jsx)("h3",{className:L().h2,children:"Enter the otp sent to your device"}),(0,n.jsx)("br",{}),(0,n.jsxs)(h.A,{size:"large",form:F,onFinish:e=>{let r=e.otp.join("");O.mutate({...R,otp:r})},children:[(0,n.jsx)(h.A.Item,{style:{width:"max-content"},name:"otp",rules:[{required:!0,message:"Please enter your OTP!"}],children:(0,n.jsx)(b.U,{onFocus:O.reset,autoFocus:!0,autoSubmit:F,inputType:"numeric"})}),(0,n.jsxs)(v.A,{gutter:[0,10],children:[(0,n.jsx)(x.A,{span:24,children:(0,n.jsx)(v.A,{justify:"end",children:(0,n.jsx)(_.Ay,{type:"link",style:{padding:"0"},onClick:()=>{O.reset(),D.reset(),F.resetFields(),F.setFields([{name:"otp",errors:void 0}])},children:"Go back"})})}),(0,n.jsx)(x.A,{span:24,children:(0,n.jsx)(_.Ay,{loading:O.isPending,danger:O.isError,htmlType:"submit",type:"primary",block:!0,children:"Submit"})})]})]})]},"otp-form")]})]})}},49561:(e,r,t)=>{"use strict";t.d(r,{f6:()=>u,th:()=>h,y1:()=>p});var n=t(23464),a=t(66608),s=t(51210),i=t(72508),o=t(49509);let c=o.env.NEXT_PUBLIC_API_URL,l=c+"/api/v1/",d=c+"/api/v2/",u=n.A.create({baseURL:l,headers:{"Content-Type":"application/json",accept:"application/json"}}),p=n.A.create({baseURL:l,headers:{"Content-Type":"application/json",accept:"application/json"}}),h=n.A.create({baseURL:d,headers:{"Content-Type":"application/json",accept:"application/json"}}),f=[p,n.A.create({baseURL:d,headers:{"Content-Type":"application/json",accept:"application/json"}})];[u,h].forEach(e=>{e.interceptors.response.use(e=>e.data,e=>e.response?Promise.reject(e.response.data.detail):Promise.reject(e.message))}),f.forEach(e=>{e.interceptors.request.use(async e=>{let r=await (0,a.g)();return e.headers.Authorization="Bearer ".concat(r.access_token?r.access_token:"no_token"),e},e=>Promise.reject(e))});let y=!1,m=null,g=[],j=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1?arguments[1]:void 0;g.forEach(t=>{let{resolve:n,reject:a,config:s}=t;e?a(e):(r&&(s.headers.Authorization="Bearer ".concat(r)),n(s))}),g=[]};f.forEach(e=>{e.interceptors.response.use(e=>e.data,async r=>{var t,n,i;let o=r.config;if((null===(t=r.response)||void 0===t?void 0:t.status)===401&&!o._retry){if(o._retry=!0,y)return new Promise((e,r)=>{g.push({resolve:e,reject:r,config:o})}).then(r=>e(r));m||(y=!0,m=v());try{if(!await m)return j("Session expired. Please login again."),await (0,s.l)(),Promise.reject("Session expired. Please login again.");{let r=await (0,a.g)();return o.headers.Authorization="Bearer ".concat(r.access_token),j(null,r.access_token),e(o)}}catch(e){return j("Authentication failed. Please login again."),await (0,s.l)(),Promise.reject("Authentication failed. Please login again.")}finally{setTimeout(()=>{m=null,y=!1},100)}}if(!r.response)return Promise.reject(r.message);{let e=r.response.status,t=(null===(n=r.response.data)||void 0===n?void 0:n.detail)||(null===(i=r.response.data)||void 0===i?void 0:i.message)||"An error occurred";return 403===e&&await (0,s.l)(),Promise.reject(t)}})});let v=async()=>{try{let e=await (0,a.g)();if(!(null==e?void 0:e.refresh_token))return await (0,s.l)(),!1;let r=o.env.NEXT_PUBLIC_API_URL;if(!r)throw Error("API URL is not defined");let t=await fetch("".concat(r,"/api/v1/refresh-token"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:e.refresh_token}),cache:"no-store"});if(!t.ok)return await (0,s.l)(),!1;let n=await t.json(),c={...e,access_token:n.access_token,refresh_token:n.refresh_token||e.refresh_token};return await (0,i.N)(c),!0}catch(e){return console.error("Token refresh failed:",e),await (0,s.l)(),!1}}},49943:(e,r,t)=>{"use strict";t.d(r,{S:()=>a});var n=t(34477);let a=(0,n.createServerReference)("7f93a37001470be152224f386714b6f67c219c5888",n.callServer,void 0,n.findSourceMapURL,"redirectTo")},51210:(e,r,t)=>{"use strict";t.d(r,{l:()=>a});var n=t(34477);let a=(0,n.createServerReference)("7f94a4f5be4bbe86ff28602338eb3b1e17757bda33",n.callServer,void 0,n.findSourceMapURL,"destroySession")},66608:(e,r,t)=>{"use strict";t.d(r,{g:()=>a});var n=t(34477);let a=(0,n.createServerReference)("7f6ef96e8b0ebd5011563da96c6f189e5e4212342a",n.callServer,void 0,n.findSourceMapURL,"getSessionClient")},72508:(e,r,t)=>{"use strict";t.d(r,{N:()=>a});var n=t(34477);let a=(0,n.createServerReference)("7f89c1213494ea9ff4952ae407cec9eb241e36637e",n.callServer,void 0,n.findSourceMapURL,"setSession")}}]);