exports.id=312,exports.ids=[312],exports.modules={717:(e,t,r)=>{"use strict";r.d(t,{Z:()=>u});var a=r(43210),s=r(54050),n=r(43313),l=r(51060);let o=async e=>{try{return await n.y1.post("files/b2/get-upload-url/",e)}catch(e){throw Error(e)}},i=async(e,t,r,a)=>{try{let s=l.A.create();s.defaults.transformRequest=[];let n=await s.put(e,t,{headers:{"Content-Type":r},validateStatus:()=>!0,onUploadProgress:a});if(n.status>=200&&n.status<300)return n.data;throw Error(`Upload failed with status ${n.status}: ${JSON.stringify(n.data)}`)}catch(e){if(console.error("B2 Upload Error:",e),e.response)throw Error(JSON.stringify(e.response.data)||"Upload failed");throw Error(e.message||"Upload failed")}},c=async e=>{try{return await n.y1.post("files/b2/confirm-upload/",e)}catch(e){throw Error(e)}};function u(){let e=function(){let[e,t]=(0,a.useState)({}),r=(0,a.useRef)({}),[n,l]=(0,a.useState)(!1),u=(0,s.n)({mutationFn:o}),d=(0,s.n)({mutationFn:({uploadUrl:e,file:a,contentType:s,fileId:n})=>i(e,a,s,e=>{let a=Math.round(100*e.loaded/e.total);t(e=>({...e,[n]:{...e[n],progress:a}})),r.current[n]?.options?.onProgress&&r.current[n].options.onProgress?.(n,a)})}),f=(0,s.n)({mutationFn:c}),p=(0,a.useCallback)(()=>`file_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,[]),m=(0,a.useCallback)((e,a)=>{let s=p(),n={id:s,file:e,options:a,status:"queued",progress:0};return t(e=>({...e,[s]:n})),r.current[s]=n,!1!==a.autoUpload&&h(s).catch(console.error),s},[]),h=(0,a.useCallback)(async e=>{let a=r.current[e];if(!a)throw Error(`File with ID ${e} not found in queue`);let{file:s,options:n}=a;t(t=>({...t,[e]:{...t[e],status:"uploading"}}));try{l(!0);let a=await u.mutateAsync({file_name:s.name,content_type:s.type,folder:n.folder||"",metadata:n.metadata||{},purpose:n.purpose,description:n.description});if(a?.status!=="success"||!a?.upload_url)throw Error("Failed to get upload URL");await d.mutateAsync({uploadUrl:a.upload_url,file:s,contentType:a.content_type,fileId:e});let o=await f.mutateAsync({file_name:a.file_name,storage_path:a.storage_path});if(o?.status!=="success")throw Error("Failed to confirm upload");let i={fileId:o.file_id,fileName:o.file_name,downloadUrl:o.download_url,publicUrl:o.public_url,status:"success"};return t(t=>({...t,[e]:{...t[e],status:"success",progress:100,result:i}})),r.current[e]={...r.current[e],status:"success",progress:100,result:i},n.onSuccess?.(o),i}catch(s){let a=s instanceof Error?s:Error(String(s));throw t(t=>({...t,[e]:{...t[e],status:"error",error:a}})),r.current[e]={...r.current[e],status:"error",error:a},n.onError?.(a),a}finally{Object.values(r.current).every(e=>"success"===e.status||"error"===e.status)&&l(!1)}},[]),g=(0,a.useCallback)(async()=>{let e=Object.keys(r.current).filter(e=>"queued"===r.current[e].status);return 0===e.length?[]:(await Promise.allSettled(e.map(e=>h(e)))).map((t,a)=>"fulfilled"===t.status?t.value:{fileId:-1,fileName:r.current[e[a]]?.file.name||"unknown",downloadUrl:"",publicUrl:"",status:"error",error:t.reason})},[h]),b=(0,a.useCallback)(async(e,t)=>h(m(e,{...t,autoUpload:!1})),[m,h]),y=(0,a.useCallback)(()=>{t({}),r.current={}},[]);return{files:e,queueFile:m,uploadFile:h,uploadAllFiles:g,uploadFileDirect:b,removeFile:(0,a.useCallback)(e=>{t(t=>{let r={...t};return delete r[e],r}),delete r.current[e]},[]),clearFiles:y,isUploading:n,errors:Object.values(e).filter(e=>"error"===e.status).map(e=>e.error)}}();return{...e,triggerUpload:e.uploadAllFiles}}},8155:(e,t,r)=>{"use strict";r.d(t,{Spin:()=>a});let a=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call Spin() from the server but Spin is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/btwaashish/Desktop/enimto-frontend/node_modules/antd/es/index.js@__barrel_optimize__?names=Spin","Spin")},9735:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});let a=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/btwaashish/Desktop/enimto-frontend/src/app/[locale]/(dashboards)/user/error.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/btwaashish/Desktop/enimto-frontend/src/app/[locale]/(dashboards)/user/error.tsx","default")},10137:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var a=r(37413),s=r(8155);let n=function(){return(0,a.jsx)(s.Spin,{spinning:!0,fullscreen:!0})}},17936:(e,t,r)=>{"use strict";r.d(t,{Ni:()=>l,Wx:()=>s,cj:()=>o,wj:()=>n});var a=r(43313);async function s(){try{return await a.y1.get("group/")}catch(e){throw Error(e)}}async function n(e){console.log("Data in createGroup:",e);try{return await a.y1.post("group/",e)}catch(e){throw Error(e)}}async function l(e){try{return await a.y1.delete(`group/${e}`)}catch(e){throw Error(e)}}async function o({data:e,id:t}){try{return await a.y1.put(`group/${t}`,e)}catch(e){throw Error(e)}}},31589:(e,t,r)=>{"use strict";r.d(t,{Spin:()=>a.A});var a=r(70553)},33585:(e,t,r)=>{Promise.resolve().then(r.bind(r,31589))},34257:(e,t,r)=>{Promise.resolve().then(r.bind(r,8155))},35954:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var a=r(60687),s=r(42585),n=r(72968),l=r(77833);let o=function({reset:e,error:t}){return(0,a.jsx)(s.A,{variant:"outlined",style:{boxShadow:"none"},children:(0,a.jsx)(n.Ay,{status:"error",title:"Something went wrong",subTitle:(0,a.jsx)(l.Ay,{type:"link",onClick:()=>e(),children:"Try again"})})})}},38127:(e,t,r)=>{Promise.resolve().then(r.bind(r,9735))},55371:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var a=r(37413),s=r(98158),n=r(20281),l=r(95565),o=r(69403);async function i({children:e}){let t=await (0,s.Ht)(),r=await (0,s.HD)();return(0,a.jsx)(n.default,{darkmode:r,children:(0,a.jsx)(o.default,{children:(0,a.jsx)(l.default,{user:t.user,children:e})})})}},64081:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var a=r(60687),s=r(35954);function n({error:e,reset:t}){return(0,a.jsx)(s.A,{error:e,reset:t})}},64562:(e,t,r)=>{"use strict";r.d(t,{default:()=>i});var a=r(60687),s=r(24937),n=r(77833);r(43210);var l=r(98109),o=r.n(l);let i=function({onClick:e,icon:t,children:r,type:l,style:i}){let{token:{colorBgBase:c}}=s.A.useToken();return(0,a.jsx)("div",{style:{...i,background:c},className:o().floatButton,onClick:e,children:(0,a.jsx)(n.Ay,{block:!0,size:"large",icon:t,type:l,children:r})})}},79249:(e,t,r)=>{"use strict";r.d(t,{default:()=>u});var a=r(60687),s=r(64562),n=r(91526),l=r(67501),o=r(43210),i=r(81440),c=r(82792);let u=function({hastitle:e=!0}){let[t,r]=(0,o.useState)(!1);return(0,a.jsxs)(l.A,{justify:"space-between",children:[e&&(0,a.jsx)(i.default,{level:3,children:"Your Groups"}),(0,a.jsx)(s.default,{type:"link",onClick:()=>{r(!0)},icon:(0,a.jsx)(n.A,{}),children:"Create Group"}),(0,a.jsx)(c.A,{isModalOpen:t,handleCancel:()=>{r(!1)},handleOk:()=>{r(!1)},flag:"create"})]})}},82792:(e,t,r)=>{"use strict";r.d(t,{A:()=>w});var a=r(60687),s=r(17936),n=r(717),l=r(12340),o=r(8693),i=r(54050),c=r(74018),u=r(44581),d=r(10678),f=r(43210),p=r(40415),m=r(52935),h=r(67501),g=r(77833),b=r(16135),y=r(99530),x=r(69587);let j=(0,f.forwardRef)(({form:e,onFinish:t,handleCancel:r,groupMutation:s,editMutation:l,flag:o,editData:i},c)=>{let[j,w]=(0,f.useState)(!1),[v,C]=(0,f.useState)([]),[A,S]=(0,f.useState)(null),{isUploading:k}=(0,n.Z)();(0,f.useImperativeHandle)(c,()=>({selectedFiles:v,imageFile:A}));let _=e=>{C(t=>t.find(t=>t.name===e.name)?t.filter(t=>t.name!==e.name):[...t,e])},E=e=>{C(t=>t.filter(t=>t.name!==e))},F=()=>{w(!1)},I={accept:"image/*",name:"file",maxCount:1,fileList:A?[{uid:"-1",name:A.name,status:"done",originFileObj:A}]:[],beforeUpload:e=>(S(e),!1),onRemove:()=>{S(null),e.setFieldValue("image",[])},customRequest:({onSuccess:e})=>{setTimeout(()=>e("ok",null),0)}};return(0,f.useEffect)(()=>{i&&e.setFieldsValue({name:i.name,description:i.description})},[i,e]),(0,a.jsxs)(u.A,{form:e,onFinish:t,layout:"vertical",children:[(0,a.jsx)(u.A.Item,{name:"name",label:"Group Name",rules:[{required:!0,message:"Please write a group name."}],children:(0,a.jsx)(m.A,{})}),i?.image_url&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(h.A,{wrap:"wrap",gap:10,align:"flex-top",children:[(0,a.jsx)(b.A,{children:"Current Image:"}),(0,a.jsx)(p.A,{style:{height:"auto",width:150},alt:"group image",fallback:!0,src:i.image_url})]}),(0,a.jsx)("br",{})]}),(0,a.jsx)(u.A.Item,{name:"image",label:"Group Image",children:(0,a.jsx)(y.A,{...I,children:(0,a.jsx)("p",{className:"ant-upload-text",children:"Click or drag image to this area to upload group image."})})}),(0,a.jsxs)(u.A.Item,{name:"csv_files",label:"CSV of Invitees",children:[(0,a.jsx)(g.Ay,{style:{width:"50%"},onClick:()=>{w(!0)},disabled:k,children:"Select CSV files"}),(0,a.jsx)(d.A,{title:"Select CSV Files",open:j,onCancel:F,footer:[(0,a.jsx)(g.Ay,{type:"primary",onClick:F,children:"Done"},"done")],width:600,children:(0,a.jsx)(y.A,{accept:".csv",name:"file",multiple:!0,fileList:[],beforeUpload:e=>(_(e),!1),customRequest:({onSuccess:e})=>{setTimeout(()=>e("ok",null),0)},disabled:k,children:(0,a.jsx)("p",{className:"ant-upload-text",children:"Click or drag CSV files to this area to select them"})})}),v.length>0&&(0,a.jsxs)("div",{style:{marginTop:"8px"},children:[(0,a.jsx)("div",{style:{fontWeight:"bold",marginBottom:"8px"},children:"Selected CSV Files:"}),(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:v.map(e=>(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",backgroundColor:"#e6f7ff",padding:"6px 12px",borderRadius:"4px",border:"1px solid #91d5ff"},children:[(0,a.jsx)(x.EHs,{size:14,color:"#1890ff",style:{marginRight:"8px"}}),(0,a.jsx)("span",{style:{flex:1},children:e.name}),(0,a.jsx)(g.Ay,{size:"small",type:"text",danger:!0,onClick:()=>E(e.name),children:"Remove"})]},e.name))}),(0,a.jsx)(g.Ay,{size:"small",type:"text",danger:!0,style:{marginTop:"8px"},onClick:()=>C([]),children:"Clear all"})]})]}),(0,a.jsx)(u.A.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please write a group description!"}],children:(0,a.jsx)(m.A.TextArea,{})}),(0,a.jsxs)(h.A,{justify:"space-between",wrap:"wrap",children:[(0,a.jsx)(g.Ay,{onClick:r,children:"Cancel"}),(0,a.jsx)(g.Ay,{loading:s?.isPending||l?.isPending||k,htmlType:"submit",type:"primary",children:"Send"})]})]})});j.displayName="GroupForm";let w=function({isModalOpen:e,handleCancel:t,handleOk:r,flag:p,editData:m}){let h=(0,l.rd)(),[g,b]=c.Ay.useMessage(),{uploadFileDirect:y}=(0,n.Z)(),x=(0,f.useRef)([]),w=(0,f.useRef)(null),v=(0,o.jE)(),C=(0,i.n)({mutationFn:s.wj,onError:e=>g.error(e.message),onSuccess:()=>{k.resetFields(),x.current=[],w.current=null,h.refresh(),v.invalidateQueries({queryKey:["groups"]}),g.success("Group created successfully!"),r()}}),A=(0,i.n)({mutationFn:s.cj,onError:e=>g.error(e.message),onSuccess:()=>{h.refresh(),k.resetFields(),x.current=[],w.current=null,g.success("Group edited successfully!"),r()}}),S=async e=>{try{let t=c.Ay.loading("Processing...",0),r=m?.image_file_id||0,a=[];if(w.current)try{let t=await y(w.current,{purpose:"group_image",description:`Group image: ${e.name}`,folder:"group-images"});if("success"===t.status)r=t.fileId;else throw Error("Image upload failed")}catch(e){t(),g.error("Failed to upload image");return}if(x.current.length>0)try{let t=x.current.map(t=>y(t,{purpose:"csv_import",description:`CSV file for group: ${e.name}`,folder:"csv-files"}));if((a=(await Promise.all(t)).filter(e=>"success"===e.status).map(e=>e.fileId)).length!==x.current.length)throw Error("Some CSV files failed to upload")}catch(e){t(),g.error("Failed to upload CSV files");return}let s={name:e.name,description:e.description,image_url:m?.image_url||"",image_file_id:r,csv_ids:a.length>0?a:m?.csv_ids||[]};t(),"create"===p?C.mutate(s):"edit"===p&&A.mutate({data:s,id:m?.id||0})}catch(e){g.error(e.message||"An error occurred")}},[k]=u.A.useForm();return(0,a.jsxs)(d.A,{title:"create"===p?"Create Group":"Edit Group",open:e,onOk:r,onCancel:t,footer:null,destroyOnClose:!0,children:[b,(0,a.jsx)(j,{ref:e=>{e&&(x.current=e.selectedFiles||[],w.current=e.imageFile||null)},editData:m,flag:p,form:k,onFinish:S,handleCancel:t,groupMutation:C,editMutation:A})]})}},88023:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var a=r(37413);async function s({children:e}){return(0,a.jsx)(a.Fragment,{children:e})}},93664:(e,t,r)=>{"use strict";r.r(t),r.d(t,{"4000a122ea2cc70bb753247e64fd726f9f01fd96a1":()=>a._C,"40a432bfa0f8d194382c24a76c80cdeb316bd7d412":()=>s.uk,"7f1d7219c8e08ca09546ba411728b3d9f723b14ce8":()=>s.Ri,"7f25d32a8a402ee9f9d4cb8aaf4dfa925845cfc819":()=>a.aX,"7f59faeca44b77173c11ff6692933b73d78f6d0f91":()=>a.HD,"7f64e16283582f1faf3527236222ddddc0522f36e8":()=>s.LZ,"7f66150a30cf20c456a4aeda77cedd35ddb2e792c2":()=>a.bz,"7f6ef96e8b0ebd5011563da96c6f189e5e4212342a":()=>a.gS,"7f89c1213494ea9ff4952ae407cec9eb241e36637e":()=>a.Nq,"7f93a37001470be152224f386714b6f67c219c5888":()=>a.SE,"7f94a4f5be4bbe86ff28602338eb3b1e17757bda33":()=>a.lx,"7f99f73dfc89beb7817ac24713fc3dab365da86234":()=>a.JK,"7fa6190648d7f0a190609a022fb98eebf4bf4d2ad0":()=>a.gV,"7fc03f74330daec80a9e1aa0286e4f7e94fb5d90ee":()=>a.J1,"7fc1f7b637360c6fc21cd39de695debb5f5c7adcd8":()=>s.E1,"7fcde306efb6b1660d9694417f01dfc0487e4d469e":()=>a.Oq,"7fe51b929297dbddbf1b0bfba928e70af34e610950":()=>a.Ht,"7fef310af4b92e4a55ef06228d79c0800c6e2efa00":()=>s.zs,"7ff6b87fca8650ccaac2893adb95fc2767def95f3f":()=>a.ri});var a=r(98158),s=r(10974)},97959:(e,t,r)=>{Promise.resolve().then(r.bind(r,64081))},98109:e=>{e.exports={floatButton:"styles_floatButton__HeivV"}}};